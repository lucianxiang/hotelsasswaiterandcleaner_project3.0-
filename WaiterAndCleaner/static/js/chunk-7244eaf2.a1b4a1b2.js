(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7244eaf2"],{"5a9e":function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("h1",{staticClass:"wrapTitle"},[e._v("订单管理")]),o("el-col",{staticClass:"formSearch",attrs:{span:24}},[o("el-form",{attrs:{inline:!0}},[o("el-form-item",[o("span",[e._v("订单筛选:")])]),o("el-form-item",[o("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"凭证码",size:"small"},model:{value:e.options.onLineNo,callback:function(t){e.$set(e.options,"onLineNo",t)},expression:"options.onLineNo"}})],1),o("el-form-item",[o("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"手机号",size:"small"},model:{value:e.options.telephone,callback:function(t){e.$set(e.options,"telephone",t)},expression:"options.telephone"}})],1),o("el-form-item",[o("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"账号",size:"small"},model:{value:e.options.userCode,callback:function(t){e.$set(e.options,"userCode",t)},expression:"options.userCode"}})],1),o("el-form-item",[o("el-select",{attrs:{placeholder:"请选择支付状态",size:"small"},model:{value:e.options.payState,callback:function(t){e.$set(e.options,"payState",t)},expression:"options.payState"}},e._l(e.payStateList,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.search}},[e._v("查询")])],1)],1)],1),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticStyle:{width:"100%",height:"100%"},attrs:{data:e.cashierOrderList,"row-key":"id","expand-row-keys":e.expands,border:""},on:{"row-click":e.rowClick}},[o("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[o("el-form-item",{attrs:{label:"订单ID:"}},[o("span",[e._v(e._s(t.row.ht_or_OrderID))])]),o("el-form-item",{attrs:{label:"用户编码:"}},[o("span",[e._v(e._s(t.row.ht_or_UserID))])]),o("el-form-item",{attrs:{label:"用户名称:"}},[o("span",[e._v(e._s(t.row.ht_or_UserName))])]),o("el-form-item",{attrs:{label:"商户编码:"}},[o("span",[e._v(e._s(t.row.ht_or_TouristTraderID))])]),o("el-form-item",{attrs:{label:"商户名称:"}},[o("span",[e._v(e._s(t.row.ht_or_TouristTraderName))])]),o("el-form-item",{attrs:{label:"凭证码:"}},[o("span",[e._v(e._s(t.row.ht_or_Password))])]),o("el-form-item",{attrs:{label:"总间数:"}},[o("span",[e._v(e._s(t.row.ht_or_TicketCount)+"间")])]),o("el-form-item",{attrs:{label:"总的网售手续费:"}},[o("span",[e._v(e._s(t.row.ht_or_SumService?t.row.ht_or_SumService:0)+"元")])]),o("el-form-item",{attrs:{label:"出单状态:"}},[o("span",[e._v(e._s(e._f("getOutStatus")(t.row.ht_or_OutStatus)))])]),o("el-form-item",{attrs:{label:"单价:"}},[o("span",[e._v(e._s(t.row.ht_or_FullPrice?t.row.ht_or_FullPrice:0)+"元")])]),o("el-form-item",{attrs:{label:"入住日期:"}},[o("span",[e._v(e._s(t.row.ht_or_InDate))])]),o("el-form-item",{attrs:{label:"离店日期:"}},[o("span",[e._v(e._s(t.row.ht_or_OutDate))])]),o("el-form-item",{attrs:{label:"发起订单时间:"}},[o("span",[e._v(e._s(t.row.ht_or_CreateTime))])]),o("el-form-item",{attrs:{label:"订单支付时间:"}},[o("span",[e._v(e._s(t.row.ht_or_PayTime))])]),o("el-form-item",{attrs:{label:"支付方式:"}},[o("span",[e._v(e._s(t.row.ht_or_PayWay))])]),o("el-form-item",{attrs:{label:"订单支付码:"}},[o("span",[e._v(e._s(t.row.ht_or_PayParam))])]),o("el-form-item",{attrs:{label:"订单状态:"}},[o("span",[e._v(e._s(e._f("getPayState")(t.row.ht_or_PayState)))])]),o("el-form-item",{attrs:{label:"手机号:"}},[o("span",[e._v(e._s(t.row.ht_od_Phone))])]),o("el-form-item",{attrs:{label:"是否结算:"}},[o("span",[e._v(e._s(1==t.row.ts_to_IsBalance?"已结算":"未结算"))])]),o("el-form-item",{attrs:{label:"备注:"}},[o("span",[e._v(e._s(t.row.ts_to_Remark))])]),o("el-form-item",{attrs:{label:"停车位数:"}},[o("span",[e._v(e._s(t.row.ht_or_CarSeats))])]),o("el-form-item",{attrs:{label:"服务员编码:"}},[o("span",[e._v(e._s(t.row.ht_or_WaiterID))])]),o("el-form-item",{attrs:{label:"订单类型:"}},[o("span",[e._v(e._s(e._f("getOrderType")(t.row.ht_or_OrderType)))])]),o("el-form-item",{attrs:{label:"编码(公司编码或会员卡号):"}},[o("span",[e._v(e._s(t.row.ht_or_ComOrMemID))])]),o("el-form-item",{attrs:{label:"是否联房:"}},[o("span",[e._v(e._s(1==t.row.ht_or_IsConnect?"联房":"未联房"))])])],1)]}}])}),o("el-table-column",{attrs:{prop:"ht_or_OrderID",label:"订单ID"}}),o("el-table-column",{attrs:{prop:"ht_or_UserName",label:"用户名称"}}),o("el-table-column",{attrs:{prop:"otaTypeName",label:"OTA"}}),o("el-table-column",{attrs:{prop:"ht_od_Phone",label:"手机号"}}),o("el-table-column",{attrs:{label:"订单状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e._f("getPayState")(t.row.ht_or_PayState)))])]}}])}),o("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{icon:"el-icon-search",type:"primary",size:"small"},on:{click:function(o){e.selectOrderDetail(t.row)}}},[e._v("订单明细\n        ")]),o("el-button",{directives:[{name:"show",rawName:"v-show",value:1!=t.row.ht_or_OutStatus,expression:"scope.row.ht_or_OutStatus!=1"}],attrs:{type:"success",size:"small"},on:{click:function(o){e.confirmOrder(t.row.ht_or_OrderID)}}},[e._v("确认订单\n        ")])]}}])})],1),o("div",{staticClass:"block",staticStyle:{"text-align":"right","margin-top":"10px"}},[o("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.total,expression:"total"}],attrs:{layout:"total,prev, pager, next","page-size":10,total:e.total},on:{"current-change":e.changePage}})],1),o("el-dialog",{attrs:{title:"订单明细","modal-append-to-body":!1,visible:e.orderDetailDialog,"close-on-click-modal":!1,width:"70%"},on:{"update:visible":function(t){e.orderDetailDialog=t}}},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.orderDetailList,border:""}},[o("el-table-column",{attrs:{prop:"ht_od_ID",label:"明细ID",width:"180"}}),o("el-table-column",{attrs:{prop:"ht_od_BuildNo",label:"栋",width:"180"}}),o("el-table-column",{attrs:{prop:"ht_od_LevelNo",label:"层"}}),o("el-table-column",{attrs:{prop:"ht_od_RoomID",label:"房间号"}}),o("el-table-column",{attrs:{prop:"ht_od_SellPrice",label:"单价(元)"}}),o("el-table-column",{attrs:{align:"center",label:"使用状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(t.row.useStatusStr))])]}}])}),o("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.item.ht_or_Password&&0==t.row.ht_od_UseStatus,expression:"scope.row.item.ht_or_Password&&scope.row.ht_od_UseStatus==0"}],attrs:{type:"success",size:"small"},on:{click:function(o){e.CheckIn(t.row)}}},[e._v("\n            入住\n          ")])]}}])})],1)],1),o("el-dialog",{attrs:{title:"入住",visible:e.checkInDialog,"modal-append-to-body":!1},on:{"update:visible":function(t){e.checkInDialog=t}}},[o("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.orderDetailObj.mainPersonInfo,"label-width":"120px",rules:e.rules}},[o("el-form-item",{attrs:{label:"住户姓名:",prop:"name"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.orderDetailObj.mainPersonInfo.name,callback:function(t){e.$set(e.orderDetailObj.mainPersonInfo,"name",t)},expression:"orderDetailObj.mainPersonInfo.name"}})],1),o("el-form-item",{attrs:{label:"身份证号:",prop:"idcard"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.orderDetailObj.mainPersonInfo.idcard,callback:function(t){e.$set(e.orderDetailObj.mainPersonInfo,"idcard",t)},expression:"orderDetailObj.mainPersonInfo.idcard"}})],1),o("el-form-item",{attrs:{label:"手机号:",prop:"phone"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.orderDetailObj.mainPersonInfo.phone,callback:function(t){e.$set(e.orderDetailObj.mainPersonInfo,"phone",t)},expression:"orderDetailObj.mainPersonInfo.phone"}})],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:e.addSameBearer}},[e._v("\n          添加同来人\n        ")]),e._l(e.orderDetailObj.otherPersonInfo,function(t,a){return o("div",[o("div",{staticClass:"clearfix"},[o("span",{staticStyle:{width:"100px",display:"inline-block",float:"left"}},[e._v("同来人"+e._s(a+1))]),o("span",{staticStyle:{display:"inline-block",float:"right",padding:"3px",color:"#f60",border:"1px solid #f60","line-height":"1","font-size":"12px","border-radius":"5px",cursor:"pointer"},on:{click:function(o){o.stopPropagation(),e.cancel(t)}}},[e._v("取消")]),o("span",{staticClass:"readCard",on:{click:function(o){o.stopPropagation(),e.getOtherIdCardInfo(t)}}},[e._v("识别身份证")])]),o("el-form",{key:a,staticClass:"demo-ruleForm",attrs:{"label-width":"120px"}},[o("el-form-item",{attrs:{label:"住户姓名:",prop:"name"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:t.name,callback:function(o){e.$set(t,"name",o)},expression:"item.name"}})],1),o("el-form-item",{attrs:{label:"身份证号:",prop:"idcard"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:t.idcard,callback:function(o){e.$set(t,"idcard",o)},expression:"item.idcard"}})],1),o("el-form-item",{attrs:{label:"手机号:",prop:"phone"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:t.phone,callback:function(o){e.$set(t,"phone",o)},expression:"item.phone"}})],1)],1)],1)})],2)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.checkInDialog=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.checkInSubmit}},[e._v("确 定")])],1)],1),e.showCancelTime?o("div",{staticClass:"distinguishIngWrap"},[o("div",{staticClass:"distinguishIng"},[o("strong",[e._v("身份证识别中...")]),o("span",[e._v(e._s(e.cancelTime)+"s未识别自动关闭")]),o("div",[o("a",{attrs:{href:"javascript:;"},on:{click:function(t){return t.stopPropagation(),e.closeTimerBtn(t)}}},[e._v("取消")])])])]):e._e(),o("audio",{ref:"messageAudio",attrs:{src:"http://hly.1000da.com.cn/audio/ordervoice.mp3"}},[e._v("\n    您的浏览器不支持 audio 标签。\n  ")]),o("audio",{ref:"roomstatechange1",attrs:{src:"http://hly.1000da.com.cn/audio/roomstatechange.mp3"}},[e._v("\n    您的浏览器不支持 audio 标签。\n  ")])],1)},r=[],s=(o("7f7f"),o("c5f6"),o("f499")),i=o.n(s),n=o("5880"),l=o("466f"),c=o("e1bf"),d={data:function(){return{cancelTime:30,cancelTimer:null,showCancelTime:!1}},created:function(){},methods:{closeCancelTimer:function(){var e=this;this.showCancelTime=!0,this.cancelTimer=setInterval(function(){e.cancelTime<1&&(clearInterval(e.cancelTimer),e.showCancelTime=!1,Object(c["a"])(),e.cancelTime=30),e.cancelTime--},1e3)},closeTimerBtn:function(){clearInterval(this.cancelTimer),this.showCancelTime=!1,Object(c["a"])(),this.cancelTime=30},getIdCardInfo:function(){var e=this;this.closeCancelTimer(),Object(c["b"])(3e4,function(t){if(200==Number(t.resultcode)){t=t.data;e.orderDetailObj.mainPersonInfo.name=t.Name,e.orderDetailObj.mainPersonInfo.idcard=t.Id,clearInterval(e.cancelTimer),e.cancelTime=30,e.showCancelTime=!1,Object(c["a"])()}else e.$notify({message:t.resultcontent,type:"error"}),clearInterval(e.cancelTimer),e.cancelTime=30,e.showCancelTime=!1,Object(c["a"])()})},getOtherIdCardInfo:function(e){var t=this;this.closeCancelTimer(),Object(c["b"])(3e4,function(o){if(200==Number(o.resultcode)){o=o.data;e.name=o.Name,e.idcard=o.Id,clearInterval(t.cancelTimer),t.showCancelTime=!1,t.cancelTime=30,Object(c["a"])()}else t.$notify({message:o.resultcontent,type:"error"}),clearInterval(t.cancelTimer),t.showCancelTime=!1,t.cancelTime=30,Object(c["a"])()})}},mounted:function(){}},m={mixins:[d],name:"",data:function(){var e=function(e,t,o){Object(l["d"])(t)?o():o(new Error("身份证格式有误!"))},t=function(e,t,o){Object(l["f"])(t)?o():o(new Error("电话号码有误!"))};return{timer:null,num:1,rules:{name:[{required:!0,message:"请输入姓名",trigger:"change"}],idcard:[{validator:e,required:!0}],phone:[{validator:t,required:!0}]},addOptions:{loginUserID:"huileyou",loginUserPass:"123",operateUserID:"",operateUserName:"",pcName:"",hotelID:"",orderDetailList:[]},orderDetailObj:{ht_od_ID:"",mainPersonInfo:{name:"",idcard:"",phone:""},otherPersonInfo:[]},checkInDialog:!1,orderDetailDialog:!1,useStateList:[{name:"未使用",id:0},{name:"已使用",id:1},{name:"已退票",id:2}],payStateList:[{name:"未支付",id:0},{name:"支付成功",id:1},{name:"已取消",id:2}],options:{loginUserID:"huileyou",loginUserPass:"123",operateUserID:"",operateUserName:"",pcName:"",hotelID:"",onLineNo:"",telephone:"",userCode:"",createTimeFrom:"",createTimeTo:"",page:1,rows:10},hotelID:"",cashierOrderList:[],orderDetailList:[],expands:[],total:0,userInfo:{},isWebSocket:!1,isWebsocketclose:!0}},computed:Object(n["mapGetters"])([]),created:function(){var e=sessionStorage.getItem("hotelID"),t=JSON.parse(sessionStorage.getItem("userInfo"));t&&(this.userInfo=t,this.addOptions.operateUserID=t.Id,this.initWebSocket()),e&&(this.options.hotelID=e,this.addOptions.hotelID=e,this.hotelID=e,this.initData())},beforeRouteLeave:function(e,t,o){this.isWebsocketclose=!1,this.websocketclose(),clearInterval(this.timer),o()},methods:{initWebSocket:function(){this.Newloading=this.$loading({lock:!0,text:"正在连接服务器....",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});var e="ws://140.143.87.152:6767/";this.websock=new WebSocket(e),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onclose=this.websocketclose},websocketonopen:function(){this.Newloading.close();var e={action:"Login",UserName:this.userInfo.serviceName,SystemName:"酒店SASS",DataType:this.userInfo.CompanyID};this.websocketsend(i()(e))},websocketonerror:function(){this.initWebSocket()},websocketonmessage:function(e){var t=JSON.parse(e.data);if(200==Number(t.resultcode))console.log("订单链接服务器成功");else if(t&&t.NotifyMessage){var o=JSON.parse(t.NotifyMessage);switch(this.MessageType=Number(o.msgType),Number(o.msgType)){case 2:this.$refs.messageAudio&&this.$refs.messageAudio.play(),this.initData();break;case 3:this.$refs.roomstatechange1&&this.$refs.roomstatechange1.play();break}}},websocketsend:function(e){this.websock.send(e)},websocketclose:function(e){var t=this;if(console.log("断开连接",e),this.isWebSocket)this.initWebSocket(),this.isWebSocket=!1;else if(this.isWebsocketclose){this.$loading({lock:!0,text:"正在连接服务器",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(function(){console.log("5秒"),t.initWebSocket()},5e3)}},changePage:function(e){this.options.page=e,this.initData()},confirmOrder:function(e){var t=this,o={loginUserID:"huileyou",loginUserPass:"123",operateUserID:"操作员编码",operateUserName:"操作员名称",pcName:"",ht_or_OrderID:e};this.$store.dispatch("ConfirmOrder",o).then(function(e){t.$notify({message:e,type:"success"}),t.initData()},function(e){t.$notify({message:e,type:"error"})})},checkInSubmit:function(){var e=this;this.$refs.ruleForm.validate(function(t){if(!t)return e.$notify({message:"请输入必填项!",type:"error"}),!1;for(var o=e.orderDetailObj.otherPersonInfo,a=0;a<o.length;a++){if(!o[a].name.trim())return void e.$notify({message:"请确保同来人姓名都以填写完整",type:"error"});if(!Object(l["d"])(o[a].idcard.trim()))return void e.$notify({message:"请确保同来人身份证号是否填写正确",type:"error"});if(!Object(l["f"])(o[a].phone.trim()))return void e.$notify({message:"请确保同来人手机号是否填写正确",type:"error"})}e.addOptions.orderDetailList=[],e.addOptions.orderDetailList.push(e.orderDetailObj),e.$store.dispatch("checkInSubmit",e.addOptions).then(function(t){e.$notify({message:t,type:"success"}),e.checkInDialog=!1,e.orderDetailDialog=!1,e.initData()},function(t){e.$notify({message:t,type:"error"}),e.checkInDialog=!1,e.orderDetailDialog=!1}).catch(function(t){e.$notify({message:t,type:"error"}),e.checkInDialog=!1,e.orderDetailDialog=!1})})},cancel:function(e){this.orderDetailObj.otherPersonInfo=this.orderDetailObj.otherPersonInfo.filter(function(t){return t.id!=e.id})},addSameBearer:function(){this.orderDetailObj.otherPersonInfo.push({id:this.num,name:"",idcard:"",phone:""}),this.num++},CheckIn:function(e){this.orderDetailObj={ht_od_ID:"",mainPersonInfo:{name:"",idcard:"",phone:""},otherPersonInfo:[]},this.orderDetailObj.ht_od_ID=e.ht_od_ID,this.checkInDialog=!0,this.getIdCardInfo()},rowClick:function(e,t,o){Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},this.expands.indexOf(e.id)<0?(this.expands=[],e.id=Object(l["b"])(),this.expands.push(e.id)):this.expands.remove(e.id)},selectOrderDetail:function(e){for(var t=0;t<e.orderDetailList.length;t++)e.orderDetailList[t].item=e;this.orderDetailList=e.orderDetailList,this.orderDetailDialog=!0},search:function(){this.initData()},initData:function(){var e=this;this.isLoading=!0,this.$store.dispatch("initCashierOrder",this.options).then(function(t){e.total=Number(t.totalRows),e.cashierOrderList=t.data,e.isLoading=!1},function(t){e.$notify.error({title:t}),e.isLoading=!1})}},mounted:function(){var e=this;this.$nextTick(function(){e.timer=setInterval(function(){e.websock&&e.websocketsend("来了")},6e4)})}},u=m,p=(o("6130"),o("2877")),f=Object(p["a"])(u,a,r,!1,null,"5eff83ed",null);t["default"]=f.exports},6130:function(e,t,o){"use strict";var a=o("e6dc"),r=o.n(a);r.a},"7f7f":function(e,t,o){var a=o("86cc").f,r=Function.prototype,s=/^\s*function ([^ (]*)/,i="name";i in r||o("9e1e")&&a(r,i,{configurable:!0,get:function(){try{return(""+this).match(s)[1]}catch(e){return""}}})},e1bf:function(e,t,o){"use strict";o.d(t,"b",function(){return i}),o.d(t,"a",function(){return n});var a=o("f499"),r=o.n(a),s={get:function(e,t){var o=new XMLHttpRequest;o.open("GET",e,!0),o.onreadystatechange=function(){(4==o.readyState&&200==o.status||304==o.status)&&t.call(this,o.responseText)},o.send()},post:function(e,t,o){var a=new XMLHttpRequest;a.open("POST",e,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4!=a.readyState||200!=a.status&&304!=a.status||o.call(this,a.responseText)},a.send(t)}},i=function(e,t){s.post("http://127.0.0.1:18008",r()({action:"GetCarIdInfo",MaxSecord:e}),function(e){var o=JSON.parse(e);1*o.resultcode==200||o.resultcode,t(o)})},n=function(e){s.post("http://127.0.0.1:18008",r()({action:"CancelRead"}),function(t){var o=JSON.parse(t);1*o.resultcode==200||1*o.resultcode==100?e&&null!=e&&e(o):console.log(t)})}},e6dc:function(e,t,o){}}]);