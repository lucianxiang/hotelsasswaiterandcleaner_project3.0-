(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2a1908ec"],{"19cb":function(e,t,s){"use strict";s.r(t);var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"wrap"}},[s("div",{attrs:{id:"leftNav"}},[s("div",{staticClass:"headPortraitBox"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.userInfo.HeadImage?e.userInfo.HeadImage:"http://hly.1000da.com.cn/assets/images/timg.jpeg",expression:"userInfo.HeadImage?userInfo.HeadImage:'http://hly.1000da.com.cn/assets/images/timg.jpeg'"}],attrs:{alt:""}})]),s("div",{staticClass:"goHomePage"},[s("router-link",{attrs:{to:"/home"}},[e._v("返回首页")])],1),s("ul",{staticClass:"routerList"},e._l(e.routerNav,function(t,o){return s("li",{class:{active:o==e.routerIndex},on:{click:function(s){s.stopPropagation(),e.changeSectionRouter(t,o)}}},[s("a",{attrs:{href:"javascript:;"}},[e._v(e._s(t.label))]),s("i",{on:{click:function(s){s.stopPropagation(),e.closeListRouter(t,o)}}})])}),0)]),s("div",{attrs:{id:"rightContent"}},[s("header",[s("div",{staticClass:"headerOperation"},e._l(e.headerOperationList,function(t,o){return s("a",{class:[t.className,{active:o==e.routerNavIndex}],attrs:{href:"javascript:;"},on:{click:function(s){e.changeRouterNav(t,o)}}},[s("i"),s("strong",[e._v(e._s(t.label))])])}),0),e._m(0)]),s("section",[s("div",{attrs:{id:"sectionWrap"}},[s("router-view")],1),s("div",{staticClass:"footerMessage"},[s("a",{staticClass:"receptionAssistant",attrs:{href:"javascript:;"},on:{click:function(t){return t.stopPropagation(),e.showReception(t)}}},[s("i"),s("strong",[e._v("前台助手")])])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showReceptionOperation,expression:"showReceptionOperation"}],attrs:{id:"receptionOperation"},on:{click:function(t){t.stopPropagation(),e.showReceptionOperation=!1}}},[s("div",{staticClass:"receptionOperationWrap",on:{click:function(t){t.stopPropagation(),e.showReceptionOperation=!0}}},[s("div",{staticClass:"operTitle"},[s("strong",[e._v("收银助手")]),s("i",{on:{click:function(t){t.stopPropagation(),e.showReceptionOperation=!1}}})]),s("div",{staticClass:"operWrap"},[s("ul",{staticClass:"operList clearfix"},e._l(e.receptionOperation,function(t,o){return s("li",{class:[t.className,{active:o==e.operIndex}],on:{click:function(s){e.changeReOper(t,o)}}},[s("i"),s("span",[e._v(e._s(t.label))])])}),0),s("div",{staticClass:"roleBox"},[s("el-select",{attrs:{placeholder:"请选择呼叫对象",size:"small"},model:{value:e.callederId,callback:function(t){e.callederId=t},expression:"callederId"}},e._l(e.staffList,function(e){return s("el-option",{key:e.Id,attrs:{label:e.Nickname,value:e.Id}})}),1),this.callederId?s("el-button",{attrs:{size:"small"},on:{click:function(t){return t.stopPropagation(),e.historyMessage(t)}}},[e._v("历史呼叫")]):e._e()],1),s("div",{staticClass:"callContent"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.operContent,expression:"operContent"}],attrs:{placeholder:"请输入内容"},domProps:{value:e.operContent},on:{input:function(t){t.target.composing||(e.operContent=t.target.value)}}})]),s("div",{staticClass:"sendCallContent clearfix"},[s("a",{attrs:{href:"javascript:;"},on:{click:e.sendCallContent}},[e._v("发送")])])])])])]),s("audio",{ref:"messageAudio",attrs:{src:"http://hly.1000da.com.cn/audio/ordervoice.mp3"}},[e._v("\n    您的浏览器不支持 audio 标签。\n  ")]),s("audio",{ref:"roomstatechange",attrs:{src:"http://hly.1000da.com.cn/audio/roomstatechange.mp3"}},[e._v("\n    您的浏览器不支持 audio 标签。\n  ")]),s("el-dialog",{attrs:{title:"历史呼叫信息",visible:e.showHistoryMessage,"modal-append-to-body":!1,width:"60%"},on:{"update:visible":function(t){e.showHistoryMessage=t}}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.historyMessageList}},[s("el-table-column",{attrs:{prop:"ht_ci_Content",label:"呼叫内容"}}),s("el-table-column",{attrs:{prop:"ht_ci_CallTime",width:"200",label:"呼叫时间"}}),s("el-table-column",{attrs:{prop:"",align:"center",width:"100",label:"处理状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("getHandleState")(t.row.ht_ci_DealState))+"\n        ")]}}])})],1),s("div",{staticClass:"block",staticStyle:{"text-align":"right"}},[e.historyMessageTotal?s("el-pagination",{attrs:{layout:"total, prev, pager, next","page-size":10,total:e.historyMessageTotal},on:{"current-change":e.changePage}}):e._e()],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showHistoryMessage=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showHistoryMessage=!1}}},[e._v("确 定")])],1)],1)],1)},i=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("i")])}],a=s("f499"),r=s.n(a),n=(s("c5f6"),s("7f7f"),s("5880")),c=(s("466f"),{computed:Object(n["mapGetters"])([]),data:function(){return{isWebSocket:!1,headerOperationList:[{className:"reportForm",label:"客房",routerName:"CashierGuestRoom",index:0},{className:"hotelStaff",label:"订单",routerName:"CashierOrder",index:1},{className:"hotelComplaint",label:"投诉",routerName:"CashierComplaint",index:2},{className:"hotelVIP",label:"会员",routerName:"CashierMemberVIP",index:3}],routerNavIndex:0,routerNav:[],routerIndex:0,userInfo:{},operIndex:0,receptionOperation:[{value:1,label:"服务员",className:"callWaiter",typeVal:2},{value:2,label:"清洁员",className:"callCleaner",typeVal:4},{value:4,label:"停车员",className:"callParking",typeVal:1}],showReceptionOperation:!1,operId:-1,operContent:"",callederId:"",staffList:[],isWebsocketclose:!0,showHistoryMessage:!1,fromDate:"",toDate:"",historyMessageList:[],historyMessageTotal:0,pageNum:1,historyMessageType:1}},beforeRouteLeave:function(e,t,s){this.isWebsocketclose=!1,this.websocketclose(),s()},created:function(){this.initRouter(),sessionStorage.getItem("userInfo")?this.userInfo=JSON.parse(sessionStorage.getItem("userInfo")):this.$router.push({name:"Login"});new Date},watch:{$route:function(e,t){"CashierGuestRoom"!=e.name&&"CashierOrder"!=e.name&&this.initWebSocket()}},methods:{historyMessage:function(){var e=this,t={loginUserID:"huileyou",loginUserPass:"123",operateUserID:"",operateUserName:"",pcName:"",page:this.pageNum,rows:10,ht_ci_Type:this.historyMessageType,ht_ci_Calleder:this.callederId,ht_ci_Caller:this.userInfo.Id};this.$store.dispatch("initHistoryMessage",t).then(function(t){e.historyMessageList=t.data,e.historyMessageTotal=Number(t.totalrows),e.showHistoryMessage=!0},function(t){e.$notify({message:t,type:"error"})}).catch(function(t){e.$notify({message:t,type:"error"})})},changePage:function(e){this.pageNum=e,this.historyMessage()},initWebSocket:function(){this.Newloading=this.$loading({lock:!0,text:"正在连接服务器....",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});var e="ws://140.143.87.152:6767/";this.websock=new WebSocket(e),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onclose=this.websocketclose},websocketonopen:function(){this.Newloading.close();var e={action:"Login",UserName:this.userInfo.serviceName,SystemName:"酒店SASS",DataType:this.userInfo.CompanyID};this.websocketsend(r()(e))},websocketonerror:function(){this.initWebSocket()},websocketonmessage:function(e){var t=JSON.parse(e.data);if(200==Number(t.resultcode))console.log("链接服务器成功");else if(t&&t.NotifyMessage){var s=JSON.parse(t.NotifyMessage);switch(this.MessageType=Number(s.msgType),console.log(s),Number(s.msgType)){case 2:this.$refs.messageAudio&&this.$refs.messageAudio.play();break;case 3:this.$refs.roomstatechange&&this.$refs.roomstatechange.play();break}}},websocketsend:function(e){this.websock.send(e)},websocketclose:function(e){var t=this;if(console.log("断开连接",e),this.isWebSocket)this.initWebSocket(),this.isWebSocket=!1;else if(this.isWebsocketclose){this.$loading({lock:!0,text:"正在连接服务器",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(function(){console.log("5秒"),t.initWebSocket()},5e3)}},initRouter:function(){var e=this;if("CashierEndHomePage"==this.$route.name)this.routerNav.push(this.headerOperationList[0]),this.$router.push({name:this.routerNav[0].routerName});else{var t=this.headerOperationList.filter(function(t){return t.routerName==e.$route.name})[0];this.routerNav.push(t)}for(var s=0;s<this.headerOperationList.length;s++)if(this.headerOperationList[s].routerName==this.routerNav[0].routerName){this.routerNavIndex=s;break}},closeListRouter:function(e,t){if(this.routerNav=this.routerNav.filter(function(t){return t.routerName!=e.routerName}),this.routerNav.length||this.routerNav.push(this.headerOperationList[0]),e.routerName==this.$route.name){this.$router.push({name:this.routerNav[this.routerNav.length-1].routerName}),this.routerIndex=this.routerNav.length-1;for(var s=0;s<this.routerNav.length;s++)if(this.routerNav[s].routerName==this.routerNav[this.routerNav.length-1].routerName)return this.routerIndex=s,void(this.routerNavIndex=this.routerNav[s].index)}else t<this.routerIndex&&this.routerIndex--,t==this.routerIndex&&(this.routerIndex=this.routerNav.length-1)},changeSectionRouter:function(e,t){this.routerNavIndex=e.index,this.routerIndex=t,this.$router.push({name:e.routerName})},changeRouterNav:function(e,t){this.routerNavIndex=t;for(var s=0;s<this.routerNav.length;s++)if(this.routerNav[s].routerName==e.routerName)return this.routerIndex=s,void this.$router.push({name:e.routerName});this.routerNav.push(e),this.routerIndex=this.routerNav.length-1,this.$router.push({name:e.routerName})},showReception:function(){this.callederId="",this.operId=this.receptionOperation[0].value,this.initAllStaff(this.receptionOperation[0].typeVal),this.showReceptionOperation=!0},initAllStaff:function(e){var t=this,s={loginUserID:"huileyou",loginUserPass:"123",operateUserID:"",operateUserName:"",pcName:"",LocalRole:e,CompanyId:this.userInfo.CompanyID,SysID:0,State:0};this.$store.commit("showLoading"),this.$store.dispatch("initHotelRole",s).then(function(e){t.initStaffList(e[0].Id)},function(e){t.$notify({message:e,type:"error"}),t.$store.commit("hideLoading")}).catch(function(e){t.$notify({message:e,type:"error"}),t.$store.commit("hideLoading")})},changeReOper:function(e,t){switch(e.value){case 1:this.historyMessageType=1;break;case 2:this.historyMessageType=2;break;case 4:this.historyMessageType=3;break;default:this.historyMessageType=1}this.operIndex=t,this.operId=e.value,this.initAllStaff(e.typeVal),this.callederId=""},sendCallContent:function(){var e=this;if(this.operContent.trim()){var t={loginUserID:"huileyou",loginUserPass:"123",operateUserID:"",operateUserName:"",pcName:"",data:{ht_ci_Type:this.operId,ht_ci_Caller:this.userInfo.Id,ht_ci_Calleder:this.callederId,ht_ci_HotelID:this.userInfo.CompanyID,ht_ci_Content:this.operContent,ht_ci_Remark:""}};this.$store.dispatch("addSendCallContent",t).then(function(t){e.$notify({message:t,type:"success"}),e.operContent=""},function(t){e.$notify({message:t,type:"error"})})}else this.$notify({message:"请输入呼叫内容",type:"error"})},initStaffList:function(e){var t=this,s={loginUserID:"huileyou",loginUserPass:"123",operateUserID:"",operateUserName:"",pcName:"",CompanyID:this.userInfo.CompanyID,RoleID:e};this.$store.dispatch("initStaffList",s).then(function(e){e.unshift({Id:0,Nickname:"全部"}),t.staffList=e,t.$store.commit("hideLoading")},function(e){t.$notify({message:e,type:"error"}),t.$store.commit("hideLoading")}).catch(function(e){t.$notify({message:e,type:"error"}),t.$store.commit("hideLoading")})}},mounted:function(){var e=this,t=this.$route.name;"CashierOrder"!=t&&"CashierGuestRoom"!=t&&this.initWebSocket(),this.$nextTick(function(){setInterval(function(){e.websock&&e.websocketsend("来了")},6e4)})}}),l=c,h=(s("d7ec"),s("2877")),u=Object(h["a"])(l,o,i,!1,null,"61841f83",null);t["default"]=u.exports},"4d5a":function(e,t,s){},"7f7f":function(e,t,s){var o=s("86cc").f,i=Function.prototype,a=/^\s*function ([^ (]*)/,r="name";r in i||s("9e1e")&&o(i,r,{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(e){return""}}})},d7ec:function(e,t,s){"use strict";var o=s("4d5a"),i=s.n(o);i.a}}]);